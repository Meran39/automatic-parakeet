## プロジェクト概要

このプロジェクトは、大規模言語モデル（LLM）によって自律的に行動する仮想住民が、ゾンビが蔓延る世界で生活するシミュレーションです。エージェントは環境と相互作用し、自身の状態（エネルギー、幸福度、空腹度、恐怖心）を管理しながら、生存と目標達成を目指します。シミュレーションの進行はリアルタイムで可視化され、ユーザーはエージェントの行動や世界の状況を把握できます。

## デモ動画

シミュレーションのデモ動画はこちらからご覧いただけます。

[https://youtu.be/ehgWH-DDcsE](https://youtu.be/ehgWH-DDcsE)

### 現在の主な機能

*   **LLM駆動のエージェント行動:**
    *   エージェントはLLM（Ollamaの`llama3`モデルを使用）からの推論に基づいて行動を決定します。
    *   エージェントの個性、現在の状態、周囲の環境（場所、他のエージェント、近くのゾンビ）がLLMへのプロンプトに反映されます。
    *   LLMは「移動」「物資調達」「待機」「メッセージ送信」「アイテムを渡す」「提案する」「提案に応答する」「ゾンビを攻撃」といった多様なアクションを生成します。
    *   LLMへのプロンプトは日本語での思考と回答を促し、アクションに必要な情報のみを返すように調整されています。
*   **エージェントの状態管理:**
    *   エージェントはエネルギー、幸福度、空腹度、恐怖心といった状態を持ち、時間経過や行動によって変化します。
    *   空腹時には食料を消費し、エネルギーが0になるとシミュレーションから除外されます。
*   **環境との相互作用:**
    *   エージェントは「自宅」「公園」「図書館」「スーパー」「拠点」「病院」といった場所を移動し、各場所で物資（食料、武器など）を調達できます。
    *   場所にはリソースが設定されており、探索によってアイテムが見つかる可能性があります。
*   **ゾンビシステム:**
    *   ゾンビがマップ上にランダムに出現し、最も近いエージェントや拠点に向かって移動します。
    *   エージェントは武器（ナイフ、刀、ピストル、ライフル）を装備してゾンビを攻撃できます。
    *   エージェントがゾンビの射程範囲内に入ると、LLMの推論を待たずに強制的に攻撃を行います。
    *   ゾンビはダメージを受けると体力が減少し、体力が0になるとシミュレーションから削除されます。
*   **エージェント間のコミュニケーション:**
    *   エージェントは他のエージェントにメッセージを送信したり、共同行動を提案したり、提案に応答したりできます。
    *   メッセージの送受信はシミュレーションログに表示されます。
*   **シミュレーションの可視化:**
    *   エージェント、場所、ゾンビが2Dマップ上で可視化されます。**D3.js** を用いて2Dマップ形式の可視化が実装されています。
    *   シミュレーションの進行状況、エージェントの行動、ゾンビの出現・撃破などがリアルタイムでログに表示されます。
    *   マップの拡大・縮小（ズーム）と移動（パン）が可能です。
*   **シミュレーション制御:**
    *   シミュレーションの開始、一時停止、リセットが可能です。
    *   シミュレーション速度の調整が可能です。
    *   LLMプロバイダー（Ollama, HuggingFace, OpenAI, Anthropic）を選択できます。
    *   新しいエージェントをシミュレーションに追加できます。
    *   シミュレーションの状態を保存・ロードできます。

### 使用技術

*   **フロントエンド:** React (TypeScript)
*   **状態管理:** React Hooks (useState, useEffect, useCallback, useRef)
*   **可視化:** D3.js
*   **LLM連携:** `ollama` (ローカルLLM実行環境) を含むカスタムLLMサービス (`src/services/llm.ts`)
*   **開発・実行環境:** Node.js (Vite, npmなどの基盤として使用)
*   **UI/UX:** Tailwind CSS, Lucide React (アイコンライブラリ)
*   **ビルドツール:** Vite
*   **その他:**
    *   `AbordController` を使用したLLMリクエストのタイムアウト処理
    *   `useRef` を活用したシミュレーションループの安定化
    *   **Three.js:** 以前3D可視化のために検討されましたが、現在はD3.jsを用いた2D可視化に方針転換しており、使用されていません。

### 今後の展望

*   エージェントの記憶と学習機能の強化
*   より複雑な感情モデルの導入
*   アイテムの多様化とクラフトシステムの追加
*   ランダムイベントや派閥システムの導入
*   UI/UXのさらなる洗練と3Dモデルの導入（将来的な検討）